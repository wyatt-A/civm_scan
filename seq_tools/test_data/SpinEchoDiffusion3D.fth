decimal
\ only forth also library definitions
\ lib-init
3      createlabels
\ PLATFORM: EVO
\ IMAGE SEQUENCE FILE:d:\smis\N20220824_00\_02_ICO61_6b0\res\220824T17_m00\civm_grad.seq
\ MR3031_PF1 FILE:d:\smis\N20220824_00\_02_ICO61_6b0\res\220824T17_m00\civm_rf.seq
VARIABLE NO_ECHOES
VARIABLE CURRENT_ECHO
VARIABLE NO_SLICES
VARIABLE CURRENT_SLICE
VARIABLE SLICE_INTERLEAVE
VARIABLE BATCH_SLICES 0 BATCH_SLICES !
VARIABLE BATCH_INTERLEAVE 1 BATCH_INTERLEAVE !
VARIABLE NO_AVERAGES
VARIABLE IMAGE_AV
2VARIABLE NO_VIEWS
2VARIABLE CURRENT_VIEW
2VARIABLE ECHO_CNT
2VARIABLE NO_VIEWS_2
VARIABLE SAMPLE_PERIOD
VARIABLE NO_SAMPLES
VARIABLE NO_DISCARD
VARIABLE VIEW_BLOCK
VARIABLE VIEW_AV
VARIABLE VIEWS_PER_SEG
VARIABLE SLICE_BLOCK
VARIABLE SLICE_AV
VARIABLE PHASE_CYCLE
VARIABLE NO_ACQ
\ COMMON OBS_MOD_LEVEL 0 f
VARIABLE REC_SEL
VARIABLE TEMP_MAC
2VARIABLE TEMP_MAC_LONG
VARIABLE GROUP_DELAY
VARIABLE TRMIN
VARIABLE CLOCK
VARIABLE TFILTER 373 TFILTER !
VARIABLE TREF
VARIABLE TIME
VARIABLE TR_EXTEND
VARIABLE TE_MS
VARIABLE TE_US
VARIABLE TE_MS_2
VARIABLE TE_US_2
VARIABLE RET
\ COMMON TR 2 f
\ COMMON TE 4 f
\ COMMON TE_EFF 6 f
\ COMMON REPORT_ON 8 f
2VARIABLE TACQ
2VARIABLE TEMPL1
2VARIABLE TEMPL2
2VARIABLE TEMPL3
2VARIABLE TEMPL4
2VARIABLE TEMPL5
2VARIABLE TR_MIN
\ COMMON T_GS_COMP a f
\ COMMON TCRUSH c f
VARIABLE ASYMM
VARIABLE RF_SP_ANGLE
VARIABLE DEG_90
VARIABLE DEG_117
VARIABLE RFSP_ON
2VARIABLE RF_INC
2VARIABLE RF_SP_TEMP
VARIABLE DEG_360
VARIABLE OVERHEAD
2VARIABLE PHASE_ANG
VARIABLE REMAINDER_PHASE
VARIABLE PHASE_CORRECTION
VARIABLE PHASE_CORRECTION_0
VARIABLE PHASE_CORRECTION_1
VARIABLE PHASE_CORRECTION_2
\ COMMON RF_ON e f
\ COMMON SUBJ_ANGLE_X 10 f
\ COMMON SUBJ_ANGLE_Y 12 f
\ COMMON SUBJ_ANGLE_Z 14 f
\ COMMON RFCAL 16 f
\ COMMON MHZ 18 f
\ COMMON KHZ 1a f
\ COMMON HZ 1c f
\ COMMON RX1MHZ 1e f
\ COMMON REC_FREQ 20 f
VARIABLE PULSE_BWDTH
VARIABLE SLICE_OFFSET
VARIABLE SLICE_OFF_FREQ
VARIABLE KHZ_NEW
VARIABLE HZ_NEW
VARIABLE KHZ_NEW2
VARIABLE HZ_NEW2
VARIABLE KHZ_NEW3
VARIABLE HZ_NEW3
2VARIABLE SLICE_FREQ_LONG
2VARIABLE READ_FREQ_LONG
\ COMMON GATING 22 f
\ COMMON CARDIAC_DEL 24 f
VARIABLE FLOW_COMP_ON
VARIABLE PE_FLOW
VARIABLE PE_FLOW_SEC
VARIABLE GR_FLOW
VARIABLE GS_FLOW
VARIABLE FLOW_MAT
\ COMMON P_SAT_SCALE 26 f
\ COMMON SAT_TCRUSH 28 f
\ COMMON SAT_GR_AMP 2a f
VARIABLE RFNUM_SAT
VARIABLE TSEL_SAT
VARIABLE SAT_PULSE_BWDTH
VARIABLE FOV_SAT_SLICE_FREQ
VARIABLE SAT_CRUSH_AMP
VARIABLE SATGS_ON
VARIABLE SAT_LIST
VARIABLE SAT_CHANNEL
VARIABLE GS_SAT
VARIABLE SAT_MAT
VARIABLE SAT_MAT_2
VARIABLE SAT_ORIENT
VARIABLE SAT_FOV_SCALE
\ COMMON P_SAT_MUL 2c f
2VARIABLE SAT_SLICE_FREQ_LONG
VARIABLE PE_REPHASE_ON
VARIABLE GRAD_SPOIL_ON
VARIABLE GRAD_SPOIL_AMP
VARIABLE SLICE_REPHASE
\ COMMON GRAD_AMP 2e f
VARIABLE SLICE_LIST
VARIABLE READ_LIST
VARIABLE PHASE_LIST
VARIABLE SCALE_READ_OFF
VARIABLE SCALE_PHASE_OFF
VARIABLE SCALE_SLICE_OFF
VARIABLE FOV_READ_FREQ
VARIABLE FOV_PHASE_DEG
VARIABLE FOV_SLICE_FREQ
VARIABLE NEW_SLICE_OFFSET
VARIABLE GP_INC
VARIABLE GP_VAR
VARIABLE DACMAX 32767 DACMAX !
VARIABLE GP_INIT_VAR_RESCALE
VARIABLE GS_VAR_RESCALE
VARIABLE OVERSAMPLE
VARIABLE OVERSAMPLE2
VARIABLE GR_OVERSAMPLE
VARIABLE GR_UNDERSAMPLE
VARIABLE GP_OVERSAMPLE
VARIABLE GP_UNDERSAMPLE
4 2CREATE-ARRAY GRAD_VAR
4 CREATE-ARRAY GRAD_VAR_L
VARIABLE TRAMP
VARIABLE GP_INIT_VAR
VARIABLE GR_VAR
VARIABLE GR_VAR_S
VARIABLE GS_VAR
VARIABLE GR_COMP
VARIABLE GR_COMP_S
VARIABLE GS_COMP
VARIABLE GS_COMP_S
VARIABLE GR_CRUSH
VARIABLE GS_CRUSH
VARIABLE GP_CRUSH
2VARIABLE DACMAXLONG 0x7fff 0x0 DACMAXLONG 2!
\ COMMON GR_COMP_SCALE 30 f
\ COMMON GS_COMP_SCALE 32 f
\ COMMON GR_ON 34 f
\ COMMON GP_ON 36 f
\ COMMON GS_ON 38 f
VARIABLE PHASE_90
VARIABLE PHASE_180
VARIABLE PHASE_117
VARIABLE TSEL90
VARIABLE TSEL180
\ COMMON P90_MUL 3a f
\ COMMON P180_MUL 3c f
VARIABLE WARMUP 20 WARMUP !
VARIABLE PHASE_RES 225 PHASE_RES !
VARIABLE RFNUM
VARIABLE PHASE_REC
VARIABLE PHASE_REC_CAL1
VARIABLE PHASE_REC_CAL2
40 CREATE-ARRAY RF_LENGTH
40 CREATE-ARRAY RF_BWDTH
40 CREATE-ARRAY RAD
40 CREATE-ARRAY RWT
40 CREATE-ARRAY RBD
\ COMMON P180_SCALE 3e f
\ COMMON ALPHA 40 f
VARIABLE FOV_READ_OFF
VARIABLE FOV_PHASE_OFF
VARIABLE FOV_SLICE_OFF
\ COMMON PHASE_VAR 42 f
\ COMMON S_ANGLE_VAR 44 f
\ COMMON P_ANGLE_VAR 46 f
\ COMMON R_ANGLE_VAR 48 f

VARIABLE MD_TDEL
VARIABLE MD_CLOCK
VARIABLE MD_ADDR
: MR3040_DELAY
MD_ADDR !
MD_CLOCK !
MD_TDEL !
MD_CLOCK @
   
10 noop
 >
IF
MD_TDEL @
10 noop
MD_CLOCK @
 */
MD_TDEL !
THEN
MD_TDEL @
   
 [ 56832 ,code 4095 ,code ]
 >
IF
BEGIN
0 noop
MD_ADDR @
1 noop
 [ 56832 ,code 4095 ,code ]
MR3040_OUTPUT
MD_TDEL @
   
 [ 56832 ,code 4095 ,code ]
 -
MD_TDEL !
MD_TDEL @
   
 [ 56832 ,code 4095 ,code ]
 > NOT
 UNTIL
THEN
MD_TDEL @
   
0 noop
 >
IF
0 noop
MD_ADDR @
1 noop
MD_TDEL @
MR3040_OUTPUT
THEN
 ;
VARIABLE TEMP_3040

VARIABLE CMT_MAT
VARIABLE CMT_S
VARIABLE CMT_P
VARIABLE CMT_R
VARIABLE CMT_I
: CREATEMATRIXTEST
CMT_R !
CMT_P !
CMT_S !
CMT_MAT !
CMT_MAT @
DACMAX @
CMT_S @
DACMAX @
CMT_P @
DACMAX @
CMT_R @
[ 56832 ,code 66 ,code ] 15 far@
[ 56832 ,code 68 ,code ] 15 far@
[ 56832 ,code 70 ,code ] 15 far@
[ 56832 ,code 72 ,code ] 15 far@
MR3040_CREATEMATRIX
CMT_I !
CMT_I @
IF
." Failed to create matrix = "
CMT_MAT @
 .
." , return code = "
CMT_I @
 .
 CR
THEN
CMT_I @
EXIT
 ;
\ MR3031_PF1 FILE:c:\smis\seqlib\RFstd.seq
\ IMAGE SEQUENCE FILE:c:\smis\seqlib\g3040_15.seq
1 CONST-LIT C_CALC_MAT
3 CONST-LIT C_D1_MAT
5 CONST-LIT C_D2_MAT
6 CONST-LIT C_PHASE_ENCODE_MAT
7 CONST-LIT C_READOUT_MAT
9 CONST-LIT C_SPOIL_MAT
VARIABLE NO_COMPLETED_AVERAGES
2VARIABLE NO_COMPLETED_VIEWS
2VARIABLE C_LUT_IDX
VARIABLE C_LUT_TEMPVAL_1
VARIABLE C_LUT_TEMPVAL_2
VARIABLE PCYCLE_TEMP
VARIABLE IS16BIT
VARIABLE PHASE_ENCODE_PHASE_GRAD_INC
VARIABLE PHASE_ENCODE_SLICE_GRAD_INC
VARIABLE C_D1_READ_LIST
VARIABLE C_D1_PHASE_LIST
VARIABLE C_D1_SLICE_LIST
VARIABLE C_D2_READ_LIST
VARIABLE C_D2_PHASE_LIST
VARIABLE C_D2_SLICE_LIST
VARIABLE C_PHASE_ENCODE_READ_LIST
VARIABLE C_PHASE_ENCODE_PHASE_LIST
VARIABLE C_PHASE_ENCODE_SLICE_LIST
VARIABLE C_READOUT_READ_LIST
VARIABLE C_SPOIL_READ_LIST
VARIABLE C_SPOIL_PHASE_LIST
VARIABLE C_SPOIL_SLICE_LIST
2VARIABLE C_D1_POSTDEL
2VARIABLE C_D2_POSTDEL
2VARIABLE C_PHASE_ENCODE_POSTDEL
2VARIABLE C_READOUT_POSTDEL
2VARIABLE C_SPOIL_POSTDEL
VARIABLE D1_READ_GRAD
VARIABLE D1_PHASE_GRAD
VARIABLE D1_SLICE_GRAD
VARIABLE D2_READ_GRAD
VARIABLE D2_PHASE_GRAD
VARIABLE D2_SLICE_GRAD
VARIABLE PHASE_ENCODE_READ_GRAD
VARIABLE PHASE_ENCODE_PHASE_GRAD
VARIABLE PHASE_ENCODE_SLICE_GRAD
VARIABLE READOUT_READ_GRAD
VARIABLE SPOIL_READ_GRAD
VARIABLE SPOIL_PHASE_GRAD
VARIABLE SPOIL_SLICE_GRAD
\ COMMON EXCITATION 4a f
\ COMMON REFOCUS 4c f
2VARIABLE C_EXCITATION_POSTDEL
2VARIABLE C_REFOCUS_POSTDEL
VARIABLE EXCITATION_PHASE
VARIABLE REFOCUS_PHASE
VARIABLE ACQ_PHASE
2VARIABLE ACQ_POST_DEL
2VARIABLE CALC_POST_DEL
\ COMMON PTS_MASK 4e f
2VARIABLE TEMPLONG1
2VARIABLE TEMPLONG2
VARIABLE OFFSETINPAGE
VARIABLE PAGE
: MAIN STREAMON DECIMAL
1 noop
IS16BIT !
0 noop
PCYCLE_TEMP !
0 noop
C_LUT_TEMPVAL_1 !
0 noop
C_LUT_TEMPVAL_2 !
 [ 56832 ,code 0 ,code 56832 ,code 0 ,code  ]
C_LUT_IDX 2!
0 noop
D1_READ_GRAD !
0 noop
D1_PHASE_GRAD !
0 noop
D1_SLICE_GRAD !
0 noop
D2_READ_GRAD !
0 noop
D2_PHASE_GRAD !
0 noop
D2_SLICE_GRAD !
0 noop
PHASE_ENCODE_READ_GRAD !
0 noop
PHASE_ENCODE_PHASE_GRAD !
0 noop
PHASE_ENCODE_SLICE_GRAD !
0 noop
READOUT_READ_GRAD !
0 noop
SPOIL_READ_GRAD !
0 noop
SPOIL_PHASE_GRAD !
0 noop
SPOIL_SLICE_GRAD !
 [ 56832 ,code 3598 ,code ]
READOUT_READ_GRAD !
 [ 56832 ,code -10051 ,code ]
PHASE_ENCODE_READ_GRAD !
0 noop
PHASE_ENCODE_PHASE_GRAD !
0 noop
PHASE_ENCODE_SLICE_GRAD !
0 noop
D1_READ_GRAD !
0 noop
D1_PHASE_GRAD !
0 noop
D1_SLICE_GRAD !
0 noop
D2_READ_GRAD !
0 noop
D2_PHASE_GRAD !
0 noop
D2_SLICE_GRAD !
 [ 56832 ,code 10051 ,code ]
SPOIL_READ_GRAD !
 [ 56832 ,code 10051 ,code ]
SPOIL_PHASE_GRAD !
 [ 56832 ,code 10051 ,code ]
SPOIL_SLICE_GRAD !
 [ 56832 ,code 39 ,code ]
PHASE_ENCODE_PHASE_GRAD_INC !
 [ 56832 ,code 39 ,code ]
PHASE_ENCODE_SLICE_GRAD_INC !
 [ 56832 ,code 1337 ,code 56832 ,code 1 ,code  ]
C_D1_POSTDEL 2!
 [ 56832 ,code -27836 ,code 56832 ,code 0 ,code  ]
C_D2_POSTDEL 2!
 [ 56832 ,code 7740 ,code 56832 ,code 0 ,code  ]
C_PHASE_ENCODE_POSTDEL 2!
 [ 56832 ,code 1200 ,code 56832 ,code 0 ,code  ]
C_READOUT_POSTDEL 2!
 [ 56832 ,code 17730 ,code 56832 ,code 9 ,code  ]
C_SPOIL_POSTDEL 2!
 [ 56832 ,code 162 ,code 56832 ,code 0 ,code  ]
C_EXCITATION_POSTDEL 2!
 [ 56832 ,code 745 ,code 56832 ,code 0 ,code  ]
C_REFOCUS_POSTDEL 2!
 [ 56832 ,code 102 ,code 56832 ,code 0 ,code  ]
ACQ_POST_DEL 2!
 [ 56832 ,code 62 ,code 56832 ,code 0 ,code  ]
CALC_POST_DEL 2!
C_CALC_MAT
MR3040_SELECTMATRIX
0 noop
2* 2* GRAD_VAR +
q2@
   
4 noop
S>D
 D/
DROP
0 noop
2* GRAD_VAR_L +
!
1 noop
2* 2* GRAD_VAR +
q2@
   
4 noop
S>D
 D/
DROP
1 noop
2* GRAD_VAR_L +
!
2 noop
2* 2* GRAD_VAR +
q2@
   
4 noop
S>D
 D/
DROP
2 noop
2* GRAD_VAR_L +
!
3 noop
2* 2* GRAD_VAR +
q2@
   
4 noop
S>D
 D/
DROP
3 noop
2* GRAD_VAR_L +
!
 [ 56832 ,code -900 ,code ]
0 noop
0 noop
3 noop
2* GRAD_VAR_L +
@
0 noop
2* GRAD_VAR_L +
@
2 noop
2* GRAD_VAR_L +
@
0 noop
2* GRAD_VAR_L +
@
1 noop
2* GRAD_VAR_L +
@
0 noop
2* GRAD_VAR_L +
@
MR3040_CREATEBASEMATRIX
TEMP_MAC !
TEMP_MAC @
IF
." Could not create base matrix, status = "
TEMP_MAC @
 .
 CR
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
0 noop
MR3040_SETLISTADDRESS
MR3040_INITLIST
TEMP_3040 !
0 noop
 [ 56832 ,code 4111 ,code ]
 [ 56832 ,code 50 ,code ]
1 noop
MR3040_OUTPUT
 [ 56832 ,code 255 ,code ]
0 noop
0 noop
0 noop
CREATEMATRIXTEST
IF
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
 [ 56832 ,code 511 ,code ]
0 noop
0 noop
0 noop
CREATEMATRIXTEST
IF
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
TEMP_3040 @
 [ 56832 ,code 546 ,code ]
MR3040_SETLIST
 [ 56832 ,code 255 ,code ]
MR3040_SELECTMATRIX
 [ 56832 ,code 546 ,code ]
MR3040_START
[ 56832 ,code 999 ,code ] us
20 noop
MR3040_CLOCK
0 noop
FREQUENCY_BUFFER
[ 56832 ,code 24 ,code ] 15 far@
[ 56832 ,code 26 ,code ] 15 far@
[ 56832 ,code 28 ,code ] 15 far@
[ 56832 ,code 30 ,code ] 15 far@
FREQUENCY
RESET_FREQUENCY
 [ 56832 ,code 400 ,code ]
PHASE_INCREMENT
NO_DISCARD @
DISCARD
8 noop
2 noop
2* RAD +
!
20 noop
2 noop
2* RWT +
!
 [ 56832 ,code -240 ,code ]
2 noop
2* RBD +
!
 [ 56832 ,code 100 ,code ]
2 noop
2* RF_LENGTH +
!
 [ 56832 ,code 50 ,code ]
2 noop
2* RF_BWDTH +
!
 [ 56832 ,code 112 ,code ]
4 noop
2* RAD +
!
20 noop
4 noop
2* RWT +
!
 [ 56832 ,code -240 ,code ]
4 noop
2* RBD +
!
 [ 56832 ,code 200 ,code ]
4 noop
2* RF_LENGTH +
!
 [ 56832 ,code 100 ,code ]
4 noop
2* RF_BWDTH +
!
0 noop
MR3040_SETLISTADDRESS
MR3040_INITLIST
C_D1_READ_LIST !
0 noop
1 noop
 [ 56832 ,code 1900 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_D1_PHASE_LIST !
0 noop
 [ 56832 ,code 476 ,code ]
 [ 56832 ,code 1900 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_D1_SLICE_LIST !
0 noop
 [ 56832 ,code 951 ,code ]
 [ 56832 ,code 1900 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_D2_READ_LIST !
0 noop
 [ 56832 ,code 1426 ,code ]
 [ 56832 ,code 1900 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_D2_PHASE_LIST !
0 noop
 [ 56832 ,code 1901 ,code ]
 [ 56832 ,code 1900 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_D2_SLICE_LIST !
0 noop
 [ 56832 ,code 2376 ,code ]
 [ 56832 ,code 1900 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_PHASE_ENCODE_READ_LIST !
0 noop
 [ 56832 ,code 2851 ,code ]
 [ 56832 ,code 400 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_PHASE_ENCODE_PHASE_LIST !
0 noop
 [ 56832 ,code 2951 ,code ]
 [ 56832 ,code 400 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_PHASE_ENCODE_SLICE_LIST !
0 noop
 [ 56832 ,code 3051 ,code ]
 [ 56832 ,code 400 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_READOUT_READ_LIST !
0 noop
 [ 56832 ,code 3151 ,code ]
 [ 56832 ,code 2120 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_SPOIL_READ_LIST !
0 noop
 [ 56832 ,code 3681 ,code ]
 [ 56832 ,code 400 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_SPOIL_PHASE_LIST !
0 noop
 [ 56832 ,code 3781 ,code ]
 [ 56832 ,code 400 ,code ]
1 noop
MR3040_OUTPUT
MR3040_INITLIST
C_SPOIL_SLICE_LIST !
0 noop
 [ 56832 ,code 3881 ,code ]
 [ 56832 ,code 400 ,code ]
1 noop
MR3040_OUTPUT
C_D1_MAT
D1_SLICE_GRAD @
   
0 noop
 +
D1_PHASE_GRAD @
   
0 noop
 +
D1_READ_GRAD @
   
0 noop
 +
CREATEMATRIXTEST
IF
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
C_D2_MAT
D2_SLICE_GRAD @
   
0 noop
 +
D2_PHASE_GRAD @
   
0 noop
 +
D2_READ_GRAD @
   
0 noop
 +
CREATEMATRIXTEST
IF
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
C_PHASE_ENCODE_MAT
PHASE_ENCODE_SLICE_GRAD @
   
0 noop
 +
PHASE_ENCODE_PHASE_GRAD @
   
0 noop
 +
PHASE_ENCODE_READ_GRAD @
   
0 noop
 +
CREATEMATRIXTEST
IF
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
C_READOUT_MAT
0 noop
0 noop
READOUT_READ_GRAD @
   
0 noop
 +
CREATEMATRIXTEST
IF
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
C_SPOIL_MAT
SPOIL_SLICE_GRAD @
   
0 noop
 +
SPOIL_PHASE_GRAD @
   
0 noop
 +
SPOIL_READ_GRAD @
   
0 noop
 +
CREATEMATRIXTEST
IF
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
SYNC
 [ 56832 ,code 0 ,code 56832 ,code 0 ,code  ]
C_LUT_IDX 2!
0 noop
S>D
NO_COMPLETED_VIEWS 2!
LABEL 1
0 noop
NO_COMPLETED_AVERAGES !
LABEL 2
STARTTIMER
HOSTREQUEST
drop
[ 56832 ,code 78 ,code ] 15 far@
SYSTEMOUT
2 noop
S>D
NO_COMPLETED_VIEWS q2@
 D*
C_LUT_IDX 2!
C_LUT_IDX q2@
   
 [ 56832 ,code 1 ,code 56832 ,code 0 ,code  ]
 D+
TEMPL3 2!
C_LUT_IDX q2@
   
 [ 56832 ,code -32768 ,code 56832 ,code 0 ,code  ]
 D/
TEMPLONG1 2!
C_LUT_IDX q2@
   
TEMPLONG1 q2@
   
 [ 56832 ,code -32768 ,code 56832 ,code 0 ,code  ]
 D*
 D-
TEMPLONG2 2!
TEMPLONG2 q2@
   
0 noop
S>D
 D!=
IF
TEMPLONG2 q2@
DROP
OFFSETINPAGE !
TEMPLONG1 q2@
DROP
PAGE !
 ELSE
0 noop
OFFSETINPAGE !
TEMPLONG1 q2@
DROP
PAGE !
THEN
IS16BIT @
IF
OFFSETINPAGE @
PAGE @
PR
C_LUT_TEMPVAL_1 !
 ELSE
OFFSETINPAGE @
PAGE @
PBR
C_LUT_TEMPVAL_1 !
THEN
PHASE_ENCODE_PHASE_GRAD_INC @
   
C_LUT_TEMPVAL_1 @
 [ 45207 ,code 48662 ,code ] swapdrop
PHASE_ENCODE_PHASE_GRAD !
TEMPL3 q2@
   
 [ 56832 ,code -32768 ,code 56832 ,code 0 ,code  ]
 D/
TEMPLONG1 2!
TEMPL3 q2@
   
TEMPLONG1 q2@
   
 [ 56832 ,code -32768 ,code 56832 ,code 0 ,code  ]
 D*
 D-
TEMPLONG2 2!
TEMPLONG2 q2@
   
0 noop
S>D
 D!=
IF
TEMPLONG2 q2@
DROP
OFFSETINPAGE !
TEMPLONG1 q2@
DROP
PAGE !
 ELSE
0 noop
OFFSETINPAGE !
TEMPLONG1 q2@
DROP
PAGE !
THEN
IS16BIT @
IF
OFFSETINPAGE @
PAGE @
PR
C_LUT_TEMPVAL_2 !
 ELSE
OFFSETINPAGE @
PAGE @
PBR
C_LUT_TEMPVAL_2 !
THEN
PHASE_ENCODE_SLICE_GRAD_INC @
   
C_LUT_TEMPVAL_2 @
 [ 45207 ,code 48662 ,code ] swapdrop
PHASE_ENCODE_SLICE_GRAD !
C_PHASE_ENCODE_MAT
PHASE_ENCODE_SLICE_GRAD @
   
0 noop
 +
PHASE_ENCODE_PHASE_GRAD @
   
0 noop
 +
PHASE_ENCODE_READ_GRAD @
   
0 noop
 +
CREATEMATRIXTEST
IF
                                      XGOTO 0
THEN
[ 56832 ,code 99 ,code ] us
C_LUT_TEMPVAL_1 @
   
 [ 56832 ,code 241 ,code ]
 +
   
C_LUT_TEMPVAL_2 @
 +
   
 [ 56832 ,code 241 ,code ]
 +
PCYCLE_TEMP !
PCYCLE_TEMP @
   
2 noop
 n/rem
   
2 noop
 [ 45207 ,code 48662 ,code ] swapdrop
   
1 noop
 -
   
1 noop
 [ 45207 ,code 48662 ,code ] swapdrop
PCYCLE_TEMP !
0 noop
EXCITATION_PHASE !
PCYCLE_TEMP @
   
2 noop
 +
REFOCUS_PHASE !
0 noop
ACQ_PHASE !
 [ 56832 ,code 20000 ,code ]
WAITTIMER
CALC_POST_DEL q2@
DELAY32
STARTTIMER
RESYNC
EXCITATION_PHASE @
PHASE
 [ 56832 ,code 150 ,code ]
WAITTIMER
 [ 56832 ,code 60 ,code ]
   
22 noop
   
WARMUP @
 +
 -
TEMP_MAC !
TEMP_MAC @
 2- us 0.7us
[ 56832 ,code 74 ,code ] 15 far@
0 noop
2 noop
2* RBD +
@
SET_BOARD_MULTIPLIERS
2 noop
2* RAD +
@
2 noop
2* RBD +
@
   
4 noop
 +
SET3031ADDRESS
2 noop
2* RWT +
@
2 noop
2* RBD +
@
   
4 noop
 +
SET3031WAITS
2 noop
2* RBD +
@
   
4 noop
 +
APPEND_BOARDS_READY
0 noop
RFAMPON
WARMUP @
 2- us 0.7us
4 noop
RFON
MR3031_GO
 [ 56832 ,code 97 ,code ]
TEMP_MAC !
TEMP_MAC @
 2- us 0.7us
0 noop
RFON
C_EXCITATION_POSTDEL q2@
DELAY32
STARTTIMER
C_D1_MAT
MR3040_SELECTMATRIX
C_D1_READ_LIST @
2 noop
MR3040_SETLIST
C_D1_PHASE_LIST @
 [ 56832 ,code 32 ,code ]
MR3040_SETLIST
C_D1_SLICE_LIST @
 [ 56832 ,code 512 ,code ]
MR3040_SETLIST
 [ 56832 ,code 300 ,code ]
WAITTIMER
 [ 56832 ,code 546 ,code ]
MR3040_START
 [ 56832 ,code 600 ,code ]
WAITTIMER
C_D1_POSTDEL q2@
DELAY32
STARTTIMER
RESYNC
REFOCUS_PHASE @
PHASE
 [ 56832 ,code 150 ,code ]
WAITTIMER
 [ 56832 ,code 60 ,code ]
   
22 noop
   
WARMUP @
 +
 -
TEMP_MAC !
TEMP_MAC @
 2- us 0.7us
[ 56832 ,code 76 ,code ] 15 far@
0 noop
4 noop
2* RBD +
@
SET_BOARD_MULTIPLIERS
4 noop
2* RAD +
@
4 noop
2* RBD +
@
   
4 noop
 +
SET3031ADDRESS
4 noop
2* RWT +
@
4 noop
2* RBD +
@
   
4 noop
 +
SET3031WAITS
4 noop
2* RBD +
@
   
4 noop
 +
APPEND_BOARDS_READY
0 noop
RFAMPON
WARMUP @
 2- us 0.7us
4 noop
RFON
MR3031_GO
 [ 56832 ,code 197 ,code ]
TEMP_MAC !
TEMP_MAC @
 2- us 0.7us
0 noop
RFON
C_REFOCUS_POSTDEL q2@
DELAY32
STARTTIMER
C_D2_MAT
MR3040_SELECTMATRIX
C_D2_READ_LIST @
2 noop
MR3040_SETLIST
C_D2_PHASE_LIST @
 [ 56832 ,code 32 ,code ]
MR3040_SETLIST
C_D2_SLICE_LIST @
 [ 56832 ,code 512 ,code ]
MR3040_SETLIST
 [ 56832 ,code 300 ,code ]
WAITTIMER
 [ 56832 ,code 546 ,code ]
MR3040_START
 [ 56832 ,code 600 ,code ]
WAITTIMER
C_D2_POSTDEL q2@
DELAY32
STARTTIMER
C_PHASE_ENCODE_MAT
MR3040_SELECTMATRIX
C_PHASE_ENCODE_READ_LIST @
2 noop
MR3040_SETLIST
C_PHASE_ENCODE_PHASE_LIST @
 [ 56832 ,code 32 ,code ]
MR3040_SETLIST
C_PHASE_ENCODE_SLICE_LIST @
 [ 56832 ,code 512 ,code ]
MR3040_SETLIST
 [ 56832 ,code 300 ,code ]
WAITTIMER
 [ 56832 ,code 546 ,code ]
MR3040_START
 [ 56832 ,code 600 ,code ]
WAITTIMER
C_PHASE_ENCODE_POSTDEL q2@
DELAY32
STARTTIMER
C_READOUT_MAT
MR3040_SELECTMATRIX
C_READOUT_READ_LIST @
2 noop
MR3040_SETLIST
 [ 56832 ,code 300 ,code ]
WAITTIMER
2 noop
MR3040_START
 [ 56832 ,code 600 ,code ]
WAITTIMER
C_READOUT_POSTDEL q2@
DELAY32
STARTTIMER
RESYNC
ACQ_PHASE @
RPHASE
 [ 56832 ,code 500 ,code ]
WAITTIMER
SAMPLE_PERIOD @
NO_SAMPLES @
ACQUIRE
ACQ_POST_DEL q2@
DELAY32
STARTTIMER
C_SPOIL_MAT
MR3040_SELECTMATRIX
C_SPOIL_READ_LIST @
2 noop
MR3040_SETLIST
C_SPOIL_PHASE_LIST @
 [ 56832 ,code 32 ,code ]
MR3040_SETLIST
C_SPOIL_SLICE_LIST @
 [ 56832 ,code 512 ,code ]
MR3040_SETLIST
 [ 56832 ,code 300 ,code ]
WAITTIMER
 [ 56832 ,code 546 ,code ]
MR3040_START
 [ 56832 ,code 600 ,code ]
WAITTIMER
C_SPOIL_POSTDEL q2@
DELAY32
NO_COMPLETED_AVERAGES @
   
1 noop
 +
NO_COMPLETED_AVERAGES !
NO_COMPLETED_AVERAGES @
   
NO_AVERAGES @
 <
IF
XGOTO 2
THEN
NO_COMPLETED_VIEWS q2@
   
1 noop
S>D
 D+
NO_COMPLETED_VIEWS 2!
NO_COMPLETED_VIEWS q2@
   
NO_VIEWS q2@
 D<
IF
XGOTO 1
THEN
LABEL 0
 ;
